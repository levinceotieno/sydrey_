<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Products</title>
  <link rel="stylesheet" href="/styles/products.css">
  <link rel="stylesheet" href="/styles/new-menu.css">
  <link rel="stylesheet" href="/styles/admin-orders-mobile.css">
</head>
<body>

  <div class="menu-backdrop" id="menu-backdrop"></div>

  <!-- Navbar Section -->
  <div class="navbar-container">
    <div class="navbar">

      <!-- ☰ Menu Icon -->
      <div class="menu-toggle" id="new-menu-toggle">☰</div>

      <!-- Brand Name -->
      <div class="logo">Sydrey Enterprise</div>

      <!-- Cart and Profile -->
      <div class="cart-profile">
      </div>
    </div>
  </div>

  <!-- Dropdown Menu -->
  <nav class="new-menu" id="new-menu">
     <ul>
        <li><a href="/">Home</a></li>
        <li><a href="/bookings/services">Services</a></li>
        <li><a href="/user/profile">Profile</a></li>
        <li><a href="/orders/history">My Orders</a></li>
        <li><a href="/blogs">Blog</a></li>
        <li><a href="/blogs/new" class="nav-link">Create Post</a></li>
     </ul>
  </nav>

 <main class="main-container">
  <h1 class="page-title">Manage Orders</h1>
  <% if (orders.length > 0) { %>
    <div class="orders-container">
      <% orders.forEach(order => { %>
        <div class="order-card">
          <div><strong>Order ID:</strong> <%= order.id %></div>
          <div><strong>User ID:</strong> <%= order.user_id %></div>
          <div><strong>Total Price:</strong> Ksh. <%= parseFloat(order.total_price).toFixed(2) %></div>
          <div><strong>Delivery Address:</strong> <%= order.delivery_address %></div>
	  <!-- <div><strong>Delivery Location:</strong> <%= order.delivery_location %></div> -->
	  <div data-status><strong>Status:</strong> <%= order.status %></div>
	  <div><strong>Delivery Date:</strong> <%= order.delivery_date %></div>
	  <div><strong>Created At:</strong> <%= new Date(order.created_at).toLocaleString() %></div>

	  <h4>Products:</h4>
	  <div class="order-products">
	    <% if (order.products && Array.isArray(order.products)) { %>
	      <% order.products.forEach(product => { %>
		<div class="order-product">
		  <span><strong><%= product.product_name %></strong></span>
		  <span>Quantity: <%= product.quantity %> × </span>
		  <span>Price: Ksh. <%= parseFloat(product.price).toFixed(2) %></span>
		</div>
	      <% }); %>
	    <% } else { %>
	      <p>No products found for this order.</p>
	    <% } %>
	  </div>

	  <form action="/admin/orders/update-status/<%= order.order_id %>" method="POST" class="update-status-form">
            <label for="status_<%= order.id %>">Update Status:</label>
            <select name="status" id="status_<%= order.id %>">
              <option value="pending" <%= order.status === 'pending' ? 'selected' : '' %>>Pending</option>
              <option value="processing" <%= order.status === 'processing' ? 'selected' : '' %>>Processing</option>
              <option value="shipped" <%= order.status === 'shipped' ? 'selected' : '' %>>Shipped</option>
              <option value="delivered" <%= order.status === 'delivered' ? 'selected' : '' %>>Delivered</option>
            </select>
            <button type="submit" class="update-button">Update</button>
          </form>

	  <!-- Delete Order Form -->
	  <form action="/admin/orders/delete/<%= order.id %>" method="POST">
    	     <button type="button" data-id="<%= order.order_id %>" class="delete-order-btn">Delete Order</button>
	  </form>
        </div>
      <% }); %>
    </div>
  <% } else { %>
    <p class="no-orders-message">No orders found.</p>
  <% } %>
 </main>
 <script src="/js/menu.js" defer></script>
 <script src="/js/admin-ordersClient.js"></script>
</body>
</html>
